<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒ³ãƒãƒ¼ã‚¯æ–¹å‘WebAR</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f0f0f0;
        }
        #messageContainer {
            font-size: 2em;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        #debugInfo {
            background-color: #e0e0e0;
            padding: 10px;
            margin-top: 20px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>ãƒ‡ãƒ³ãƒãƒ¼ã‚¯æ–¹å‘AR</h1>
    <div id="messageContainer">ãƒ‡ãƒã‚¤ã‚¹ã‚’å‚¾ã‘ã¦ã¿ã¦ãã ã•ã„</div>
    <div id="debugInfo">æ–¹ä½ã‚»ãƒ³ã‚µãƒ¼ã‚’æº–å‚™ä¸­...</div>

    <script>
        const messageContainer = document.getElementById('messageContainer');
        const debugInfo = document.getElementById('debugInfo');

        // ãƒ‡ãƒ³ãƒãƒ¼ã‚¯ã®åº§æ¨™ï¼ˆå›ºå®šå€¤ï¼‰
        const DENMARK_LAT = 55;
        const DENMARK_LON = 10;

        // 2ç‚¹é–“ã®æ–¹ä½è§’ã‚’è¨ˆç®—
        function calculateBearing(userLat, userLon, targetLat, targetLon) {
            const toRad = (degrees) => degrees * Math.PI / 180;
            const toDeg = (radians) => radians * 180 / Math.PI;

            const Ï†1 = toRad(userLat);
            const Ï†2 = toRad(targetLat);
            const Î”Î» = toRad(targetLon - userLon);

            const y = Math.sin(Î”Î») * Math.cos(Ï†2);
            const x = Math.cos(Ï†1) * Math.sin(Ï†2) - Math.sin(Ï†1) * Math.cos(Ï†2) * Math.cos(Î”Î»);
            let bearing = toDeg(Math.atan2(y, x));

            // åŒ—ã‚’åŸºæº–ã«æ™‚è¨ˆå›ã‚Šã®è§’åº¦ã«èª¿æ•´
            return (bearing + 360) % 360;
        }

        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ±äº¬ã®åº§æ¨™ã‚’ä½¿ç”¨
        const DEFAULT_LAT = 35.6762; // æ±äº¬ã®ç·¯åº¦
        const DEFAULT_LON = 139.6503; // æ±äº¬ã®çµŒåº¦

        function initOrientationSensor() {
            function handleOrientation(event) {
                // ãƒ‡ãƒã‚¤ã‚¹ã®æ–¹ä½è§’ï¼ˆã‚³ãƒ³ãƒ‘ã‚¹ã®å‘ãï¼‰ã‚’å–å¾—
                const compassHeading = event.webkitCompassHeading || event.alpha;

                // ãƒ‡ãƒ³ãƒãƒ¼ã‚¯ã¸ã®æ–¹ä½è§’ã‚’è¨ˆç®—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåº§æ¨™ã‚’ä½¿ç”¨ï¼‰
                const danmarkBearing = calculateBearing(
                    DEFAULT_LAT, 
                    DEFAULT_LON, 
                    DENMARK_LAT, 
                    DENMARK_LON
                );

                // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’æ›´æ–°
                debugInfo.textContent = `
                    ç¾åœ¨ã®ã‚³ãƒ³ãƒ‘ã‚¹æ–¹ä½: ${Math.round(compassHeading)}åº¦
                    ãƒ‡ãƒ³ãƒãƒ¼ã‚¯æ–¹å‘: ${Math.round(danmarkBearing)}åº¦
                `;

                // ãƒ‡ãƒ³ãƒãƒ¼ã‚¯ã®æ–¹å‘ï¼ˆÂ±15åº¦ã®è¨±å®¹ç¯„å›²ï¼‰
                const angleDifference = Math.abs(
                    ((compassHeading - danmarkBearing + 180 + 360) % 360) - 180
                );

                if (angleDifference <= 15) {
                    messageContainer.innerHTML = `
                        <span style="color: red;">ã‚µãƒ³ã‚¿ãŒã„ã‚‹ã‚ˆï¼ğŸ…</span>
                    `;
                    messageContainer.style.backgroundColor = '#e6f2ff';
                } else {
                    messageContainer.innerHTML = 'ãƒ‡ãƒã‚¤ã‚¹ã‚’ãƒ‡ãƒ³ãƒãƒ¼ã‚¯ã®æ–¹å‘ã«å‘ã‘ã¦ã¿ã¦ãã ã•ã„';
                    messageContainer.style.backgroundColor = '#fff';
                }
            }

            // ãƒ‡ãƒã‚¤ã‚¹ã®æ–¹ä½ã‚»ãƒ³ã‚µãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯
            if (window.DeviceOrientationEvent) {
                window.addEventListener('deviceorientation', handleOrientation);
            } else {
                debugInfo.textContent = 'ã“ã®ãƒ‡ãƒã‚¤ã‚¹ã¯æ–¹ä½ã‚»ãƒ³ã‚µãƒ¼ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“';
            }
        }

        // æ–¹ä½ã‚»ãƒ³ã‚µãƒ¼ã®åˆæœŸåŒ–
        initOrientationSensor();
    </script>
</body>
</html>
